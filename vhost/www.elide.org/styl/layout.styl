/* $Id$ */

body {
	margin:  0;
	padding: 0;
	padding-bottom: ($baseline * 3);

	clearfix();
}

section.page {
	// TODO: max-width: $baseline * 100;

	h2 {
		padding-top: ceil($baseline * 0.0);
		font-size:       2em;
		line-height:     ($baseline * 1.0);
	}

	& > dl.index {
		dt a {
			display: block;

// XXX: align to grid
			width: 25%;
			float: left;
			clear: left;

			padding: 0.5ex  2ex;
			margin: -0.5ex -2ex;
		}
	}

}

header {
	margin-top:    ($baseline * 5.0);
	margin-bottom: ($baseline * 2.0);

	/* respond when the page height is below 30 lines */
	$q = "all and (max-height: " + ($baseline * 30) + ")";
	@media $q {
		margin-top: ($baseline * 2.0);
	}

	h1 {
		padding-top:    ceil($baseline * 0.5);
		font-size:          2.7em;
		line-height:        ($baseline * 2.0);
		padding-bottom: ceil($baseline * 0.5);
	}
}

footer {
	margin-top:    ($baseline * 2);
	margin-bottom: ($baseline * 2);
	display: none; /* XXX */
}

section.page section.archive-year[data-count = "0"] {
	display: none;
}

section.page section.archive-year > ol {
	list-style-type: none;
}

section.page section.archive-year {
	& > h1 {
		&:after {
			content: " ";
		}

		a {
			display: none;
		}
	}
}

section.page article.entry {
	time.update,
	a[name],
	ul.tags {
		display: block;
		position: relative;
		text-align: left;
	}
}

nav#monthindex {
	display: block;
	margin-top:    ($baseline * 1);
	margin-bottom: ($baseline * 1);

	font-size: .9em;

	ol.pages {
		float: left;
	}

	& > a {
		float: right;
	}
}

article.entry {
	ul.tags {
		margin-top: ($baseline * 1);
	}
}

nav#sidebar {
	display: none;

	table.calendar {
		table-layout: fixed;

		max-width:   (12 * $baseline);
		margin-left: (6  * $baseline);
		width: 100%;

		/* TODO: mixin? */
		border-spacing: 0 ! important;
		border-collapse: collapse ! important;
	}

	ol.years {
		display: none;
		float: left;
		margin-left:   $gutter;
		margin-bottom: $gutter;
	}
}

nav.pages {
	padding-top:    ($baseline * 1);
	padding-bottom: ($baseline * 4);
}

pre {
	overflow-y: auto;
	margin-left: 0;
}

for $l in 0 .. length($ncols) - 1 {
	$q = grid-breakpoint($grid, $l, min);
	@media $q {
		header,
		section.page,
		footer {
			grid-container($grid, $l);
		}

		if ($ncols[$l] <= 2) {
			header h1,
			header ul {
				grid-column($grid, $l, $ncols[$l]);
			}

			section.page > * {
				grid-column($grid, $l, $ncols[$l]);
			}

			nav#monthindex {
				grid-subcontainer($grid, $l, $ncols[$l], 0);
				$subgrid = grid-subgrid($grid, $l, 0);

				ol.pages,
				& > a {
					grid-column($subgrid, $l, $ncols[$l]);
				}
			}
		}

		if ($ncols[$l] >= 2) {
			nav#monthindex {
				pages-collapse-outer(data-fmt);
			}
		}

		if ($ncols[$l] >= 4) {
			header h1,
			header ul {
				grid-column($grid, $l, $ncols[$l] - 1, 1);
			}

			section.page > * {
				grid-column($grid, $l, $ncols[$l] - 1, 1);
			}

			section.page > article.entry {
				grid-subcontainer($grid, $l, $ncols[$l], 0);
				$subgrid = grid-subgrid($grid, $l, 0);

				& > * {
					grid-column($subgrid, $l, $ncols[$l] - 1);
				}

				& > time.update,
				& > a[name],
				& > ul.tags {
					grid-column($subgrid, $l, 1);
				}
			}

			nav#monthindex {
				grid-subcontainer($grid, $l, $ncols[$l] - 1, 1);
				$subgrid = grid-subgrid($grid, $l, 1);

				ol.pages {
					grid-column($subgrid, $l, $ncols[$l] - 2);
				}

				& > a {
					grid-column($subgrid, $l, 1);
				}
			}
		}

		if ($ncols[$l] >= 5) {
			header h1,
			header ul {
				grid-column($grid, $l, 4, 1);
			}
		}
	}

	$q = "%s and %s" % (grid-breakpoint($grid, $l, min) grid-breakpoint($grid, $l, max));
	@media $q {
		nav#monthindex {
			/* TODO: could animate collapsing by transitioning on width to 0 */
			if ($ncols[$l] == 1) {
				/* when too narrow to fit the attr() months */
				pages-collapse-group(false);
			}

			if ($ncols[$l] >= 2 && $ncols[$l] <= 5) {
				/* when too narrow to fit all 12 months explicitly */
				pages-collapse-group(data-fmt);
			}

			if ($ncols[$l] <= 2) {
				& > a,
				ol.pages {
					text-align: center;
				}

				& > a {
					margin-top: 2ex; // XXX: hacky
				}
			}
		}
	}
}

